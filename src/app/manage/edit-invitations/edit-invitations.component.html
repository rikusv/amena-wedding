<nav class="navbar navbar-light bg-light">
  <a class="navbar-brand">Amena and Ferhat's Wedding</a>
</nav>

<div class="container-fluid">
  <form [formGroup]="newInvitationForm" (ngSubmit)="onAdd()">
    <div class="row mt-3">
      <div class="input-group col-md-6 col-12 my-1">
        <div class="input-group-prepend">
          <span class="input-group-text">+</span>
        </div>
        <input type="tel" pattern="[0-9]*" required class="form-control" [class.is-invalid]="phone.invalid && (phone.dirty || phone.touched)" placeholder="Phone" formControlName="phone">
        <input type="text" required class="form-control" [class.is-invalid]="name.invalid && (name.dirty || name.touched)" name="name" placeholder="Name" formControlName="name">
      </div>
      <div class="input-group col-md-6 col-12 my-1">
        <div class="input-group-prepend">
          <span class="input-group-text">Group</span>
        </div>
        <input type="text" class="form-control" placeholder="Group" formControlName="group">
      </div>
      <div class="input-group col-md-6 col-12 my-1" *ngFor="let id of objectKeys(newInvitationForm?.controls.events?.controls)">
        <div class="input-group-prepend">
          <span class="input-group-text">{{ (eventLookup$ | async)[id].name }}</span>
          <span class="input-group-text bg-light">Max</span>
        </div>
        <ng-container formGroupName="events">
          <input type="number" class="form-control" [formControlName]="id">
        </ng-container>
        <div class="input-group-prepend">
          <span class="input-group-text bg-light">RSVP</span>
        </div>
        <ng-container formGroupName="rsvp">
          <input type="number" class="form-control" [formControlName]="id">
        </ng-container>
      </div>
      <div class="col-md-6 col-12 my-1">
        <div class="form-group form-check form-check-inline">
          <input type="checkbox" class="form-check-input" formControlName="unlikely">
          <label class="form-check-label">Unlikely</label>
        </div>
        <div class="form-group form-check form-check-inline">
          <input type="checkbox" class="form-check-input" formControlName="wishlist">
          <label class="form-check-label">Wishlist</label>
        </div>
      </div>
    </div>
    <p *ngIf="phone.invalid && (phone.dirty || phone.touched)">
      <ngb-alert *ngIf="phone.errors.required" type="warning" [dismissible]="false">
        Phone number is <strong>required</strong>.
      </ngb-alert>
      <ngb-alert *ngIf="phone.errors.pattern" type="warning" [dismissible]="false">
        Phone number must be <strong>digits only</strong>.
      </ngb-alert>
    </p>
    <p *ngIf="name.invalid && (name.dirty || name.touched)">
      <ngb-alert *ngIf="name.errors.required" type="warning" [dismissible]="false">
        Name is <strong>required</strong>.
      </ngb-alert>
    </p>
    <button type="submit" [disabled]="!newInvitationForm.valid" class="btn btn-primary btn-block my-3">Add Invitation</button>
  </form>
</div>

<ngb-accordion *ngFor="let invitation of (invitations$ | async | filter:(searchResult$ | async))" [closeOthers]="true">
  <ngb-panel [title]="invitation.name + ' +' + invitation.phone + (invitation.group ? ' (' + invitation.group + ')' : '')">
    <ng-template ngbPanelContent>
      <div class="row">
        <div class="input-group col-md-6 col-12 my-1">
          <div class="input-group-prepend">
            <span class="input-group-text">+</span>
          </div>
          <input type="tel" class="form-control" placeholder="Phone" [(ngModel)]="invitation.phone">
          <input type="text" class="form-control" placeholder="Name" [(ngModel)]="invitation.name">
        </div>
        <div class="input-group col-md-6 col-12 my-1">
          <div class="input-group-prepend">
            <span class="input-group-text">Group</span>
          </div>
          <input type="text" class="form-control" placeholder="Group" [(ngModel)]="invitation.group">
        </div>
        <div class="input-group col-md-6 col-12 my-1" *ngFor="let event of events">
          <div class="input-group-prepend">
            <span class="input-group-text">{{ event.name }}</span>
            <span class="input-group-text bg-light">Max</span>
          </div>
          <input type="number" class="form-control" [(ngModel)]="invitation.events[event.id]">
          <div class="input-group-prepend">
            <span class="input-group-text bg-light">RSVP</span>
          </div>
          <input type="number" class="form-control" [(ngModel)]="invitation.rsvp[event.id]">
        </div>
        <div class="col-md-6 col-12 my-1">
          <div class="form-group form-check form-check-inline">
            <input type="checkbox" class="form-check-input" [(ngModel)]="invitation.unlikely">
            <label class="form-check-label">Unlikely</label>
          </div>
          <div class="form-group form-check form-check-inline">
            <input type="checkbox" class="form-check-input" [(ngModel)]="invitation.wishlist">
            <label class="form-check-label">Wishlist</label>
          </div>
        </div>
      </div>
      <div class="row">
        <button type="button" class="col btn btn-primary float-left mx-3" (click)="onChange(invitation)">Save</button>
        <button type="button" class="col btn btn-danger float-right mx-3" (click)="onDelete(invitation)">Delete</button>
      </div>
    </ng-template>
  </ngb-panel>
</ngb-accordion>

<div class="fixed-bottom mx-3">
  <ngb-alert *ngFor="let message of (messageService.messages$ | async)" [type]="message.type" [dismissible]="false">
    {{ message.text }}
  </ngb-alert>
</div>

<!-- <div ngbDropdown placement="top-left" class="d-inline-block">
<button class="btn btn-outline-primary" ngbDropdownToggle>RSVP</button>
<div ngbDropdownMenu>
<button *ngFor="let i of numbers(event.max)" class="dropdown-item" (click)="rsvp(event, i)">{{ i }}</button>
</div>
</div> -->
