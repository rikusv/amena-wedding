<div class="container-fluid">
  <ngb-alert *ngIf="numberOfResults" [ngPlural]="numberOfResults" type="info" [dismissible]="false">
    <ng-template ngPluralCase="=1">{{ numberOfResults }} invitation matched</ng-template>
    <ng-template ngPluralCase="other">{{ numberOfResults }} invitations matched</ng-template>
  </ngb-alert>
  <form [formGroup]="newInvitationForm" (ngSubmit)="onAdd()">
    <div class="row mt-3">
      <div class="input-group col-md-6 col-12 my-1">
        <div class="input-group-prepend">
          <span class="input-group-text">+</span>
        </div>
        <input type="tel" pattern="[0-9]*" required class="form-control" [class.is-invalid]="phone.invalid && (phone.dirty || phone.touched)" placeholder="Phone" formControlName="phone">
        <input type="text" required class="form-control" [class.is-invalid]="name.invalid && (name.dirty || name.touched)" name="name" placeholder="Name" formControlName="name">
      </div>
      <div class="input-group col-md-6 col-12 my-1">
        <div class="input-group-prepend">
          <span class="input-group-text">Surname</span>
        </div>
        <input type="text" class="form-control" placeholder="Surname" formControlName="surname">
      </div>
      <div class="input-group col-md-6 col-12 my-1">
        <div class="input-group-prepend">
          <span class="input-group-text">Group</span>
        </div>
        <input type="text" class="form-control" placeholder="Group" formControlName="group">
      </div>
      <div class="input-group col-md-6 col-12 my-1" *ngFor="let event of eventsOnceFormReady()">
        <ng-container *ngIf="!event.public">
          <div class="input-group-prepend">
            <span class="input-group-text">{{ event.name }}</span>
            <span class="input-group-text bg-light">Max</span>
          </div>
          <ng-container formGroupName="events">
            <input type="number" class="form-control" [formControlName]="event.id">
          </ng-container>
          <div class="input-group-prepend">
            <span class="input-group-text bg-light">RSVP</span>
          </div>
          <ng-container formGroupName="rsvp">
            <input type="number" class="form-control" [formControlName]="event.id">
          </ng-container>
        </ng-container>
      </div>
      <div class="col-md-6 col-12 my-1">
        <div class="form-group form-check form-check-inline">
          <input type="checkbox" class="form-check-input" formControlName="unlikely">
          <label class="form-check-label">Unlikely</label>
        </div>
        <div class="form-group form-check form-check-inline">
          <input type="checkbox" class="form-check-input" formControlName="wishlist">
          <label class="form-check-label">Wishlist</label>
        </div>
      </div>
    </div>
    <p *ngIf="phone.invalid && (phone.dirty || phone.touched)">
      <ngb-alert *ngIf="phone.errors.required" type="warning" [dismissible]="false">
        Phone number is <strong>required</strong>.
      </ngb-alert>
      <ngb-alert *ngIf="phone.errors.pattern" type="warning" [dismissible]="false">
        Phone number must be <strong>digits only</strong>.
      </ngb-alert>
    </p>
    <p *ngIf="name.invalid && (name.dirty || name.touched)">
      <ngb-alert *ngIf="name.errors.required" type="warning" [dismissible]="false">
        Name is <strong>required</strong>.
      </ngb-alert>
    </p>
    <button type="submit" [disabled]="!newInvitationForm.valid" class="btn btn-primary btn-block my-3">Add Invitation</button>
  </form>
</div>

<div class="table-responsive">
  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th scope="col">Phone</th>
        <th scope="col">Name</th>
        <th scope="col">Surname</th>
        <th scope="col">Group</th>
        <th *ngFor="let event of rsvpEvents" scope="col">{{ event.name }}</th>
        <th scope="col">Wishlist</th>
        <th scope="col">Unlikely</th>
        <th scope="col">Sent</th>
      </tr>
    </thead>
    <tbody>
      <tr (click)="onInvitationPress(invitation)" *ngFor="let invitation of (invitations$ | async | filter:(searchResult$ | async))">
        <td>{{ invitation.phone }}</td>
        <td>{{ invitation.name }}</td>
        <td>{{ invitation.surname }}</td>
        <td>{{ invitation.group }}</td>
        <td *ngFor="let event of rsvpEvents">
          {{ invitation.rsvp[event.id] }} / {{ invitation.events[event.id] }}
        </td>
        <td>{{ invitation.wishlist == true ? 'X' : '' }}</td>
        <td>{{ invitation.unlikely == true ? 'X' : '' }}</td>
        <td>{{ invitation.invitationSent == true ? 'X' : '' }}</td>
      </tr>
    </tbody>
  </table>
</div>
